<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAOS Debugger - Complete System</title>
    <style>
        :root {
            --bg-primary: #1e1e2e;
            --bg-secondary: #2a2a3a;
            --bg-tertiary: #363646;
            --text-primary: #dcd7ba;
            --text-secondary: #a6a6a6;
            --accent-primary: #7e9cd8;
            --accent-secondary: #957fb8;
            --success: #76946a;
            --warning: #dca561;
            --error: #e82424;
            --critical: #ff5555;
            --border-radius: 8px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Fira Code', monospace, system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-x: hidden;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        button {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background-color: var(--bg-tertiary);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button.primary {
            background-color: var(--accent-primary);
            color: #1a1a2e;
        }

        button.warning {
            background-color: var(--warning);
            color: #2a2a1a;
        }

        button.danger {
            background-color: var(--error);
            color: #2a1a1a;
        }

        button.success {
            background-color: var(--success);
            color: #1a2a1a;
        }

        button.critical {
            background-color: var(--critical);
            color: #2a1a1a;
            animation: pulseCritical 1.5s infinite;
        }

        @keyframes pulseCritical {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            flex: 1;
        }

        .simulation-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .nodes-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .node {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all var(--transition-speed);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--bg-tertiary);
        }

        .node::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background-color: var(--bg-tertiary);
        }

        .node-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .node-title {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .node-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-idle {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .status-running {
            background-color: var(--success);
            color: #1a2a1a;
        }

        .status-waiting {
            background-color: var(--warning);
            color: #2a2a1a;
        }

        .status-terminated {
            background-color: var(--error);
            color: #2a1a1a;
        }

        .status-critical {
            background-color: var(--critical);
            color: #2a1a1a;
            animation: pulseCritical 1.5s infinite;
        }

        .node-body {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .metric {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .metric-value {
            font-weight: 600;
        }

        .progress-container {
            height: 8px;
            background-color: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .cpu-progress {
            background-color: var(--accent-primary);
        }

        .memory-progress {
            background-color: var(--accent-secondary);
        }

        .disk-progress {
            background-color: var(--info);
        }

        .network-progress {
            background-color: var(--success);
        }

        .heartrate-progress {
            background-color: var(--critical);
        }

        .node-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .node-actions button {
            flex: 1;
            padding: 8px;
            font-size: 0.8rem;
        }

        .log-panel {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 180px);
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .log-controls {
            display: flex;
            gap: 10px;
        }

        .log-content {
            flex: 1;
            overflow-y: auto;
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: 15px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .log-entry {
            margin-bottom: 8px;
            display: flex;
            gap: 10px;
            word-break: break-all;
        }

        .log-timestamp {
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .log-message {
            flex: 1;
        }

        .log-info {
            color: var(--info);
        }

        .log-warning {
            color: var(--warning);
        }

        .log-error {
            color: var(--error);
        }

        .log-success {
            color: var(--success);
        }

        .log-critical {
            color: var(--critical);
        }

        .system-controls {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--accent-primary);
        }

        .control-row {
            display: flex;
            gap: 10px;
        }

        .control-row button {
            flex: 1;
        }

        .communication-visualizer {
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: auto;
        }

        .comm-title {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--accent-secondary);
        }

        .comm-lines {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .comm-line {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .comm-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }

        .comm-message {
            color: var(--text-secondary);
        }

        /* Heart Rate Monitor Styles */
        .heartrate-monitor {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .heartrate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .heartrate-title {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .heartrate-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .heartrate-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .heartrate-normal {
            color: var(--success);
        }

        .heartrate-warning {
            color: var(--warning);
        }

        .heartrate-critical {
            color: var(--critical);
            animation: pulseCritical 1.5s infinite;
        }

        .heartrate-graph-container {
            height: 150px;
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: 10px;
            position: relative;
            overflow: hidden;
        }

        .heartrate-graph {
            width: 100%;
            height: 100%;
        }

        .heartrate-thresholds {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .heartrate-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .heartrate-controls button {
            flex: 1;
            padding: 8px;
            font-size: 0.8rem;
        }

        /* Animation classes */
        .node-booting {
            animation: booting 2s ease-in-out;
        }

        @keyframes booting {
            0% { transform: scale(0.9); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }

        .node-shutting-down {
            animation: shuttingDown 1.5s ease-in-out forwards;
        }

        @keyframes shuttingDown {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.9); opacity: 0; }
        }

        .node-error {
            animation: errorFlash 0.5s ease-in-out 3;
        }

        @keyframes errorFlash {
            0%, 100% { border-left-color: var(--bg-tertiary); }
            50% { border-left-color: var(--error); }
        }

        .node-critical {
            animation: criticalFlash 0.5s ease-in-out infinite;
        }

        @keyframes criticalFlash {
            0%, 100% { border-left-color: var(--bg-tertiary); }
            50% { border-left-color: var(--critical); }
        }

        /* Testing Section */
        .testing-section {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            border: 2px dashed var(--warning);
        }

        .testing-section h2 {
            color: var(--warning);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .testing-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .log-panel {
                height: auto;
                max-height: 300px;
            }
        }

        @media (max-width: 768px) {
            .nodes-container {
                grid-template-columns: 1fr;
            }

            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .controls {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#7e9cd8" stroke-width="2"/>
                <path d="M12 16V16.01M8 8V8.01M16 8V8.01M8 12V12.01M16 12V12.01M8 16V16.01M16 16V16.01" stroke="#957fb8" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <h1>HAOS Debugger</h1>
        </div>
        <div class="controls">
            <button id="startSimulation" class="primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 3L19 12L5 21V3Z" fill="currentColor"/>
                </svg>
                Start Simulation
            </button>
            <button id="triggerInterrupt" class="warning" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 8V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Trigger Interrupt
            </button>
            <button id="shutdownSystem" class="danger" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 3V12M18.36 6.64C19.6184 7.89879 20.4753 9.50244 20.8223 11.2482C21.1693 12.9939 20.9909 14.8034 20.3096 16.4478C19.6284 18.0921 18.4748 19.4976 16.9948 20.4864C15.5148 21.4752 13.7749 22.0029 11.995 22.0029C10.2151 22.0029 8.47515 21.4752 6.99517 20.4864C5.51519 19.4976 4.36164 18.0921 3.68036 16.4478C2.99909 14.8034 2.82069 12.9939 3.16772 11.2482C3.51475 9.50244 4.37162 7.89879 5.63 6.64" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Shutdown System
            </button>
        </div>
    </header>

    <div class="main-container">
        <div class="simulation-area">
            <!-- Heart Rate Monitor Section -->
            <div class="heartrate-monitor">
                <div class="heartrate-header">
                    <div class="heartrate-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 14L21 12M21 12L19 10M21 12H3M5 10L3 12M5 14L3 12M3 12L5 12" stroke="var(--critical)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7.5 10C8.5 11 10.5 11 11.5 10L14.5 7C15.5 6 17.5 6 18.5 7V7M7.5 14C8.5 13 10.5 13 11.5 14L12.5 15C13.5 16 15.5 16 16.5 15V15" stroke="var(--critical)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        System Heart Rate Monitor
                    </div>
                    <div class="heartrate-status">
                        <span class="heartrate-value heartrate-normal" id="heartrateValue">60</span>
                        <span class="heartrate-bpm">BPM</span>
                    </div>
                </div>
                <div class="heartrate-graph-container">
                    <canvas id="heartrateGraph" class="heartrate-graph"></canvas>
                </div>
                <div class="heartrate-thresholds">
                    <span>Normal: &lt; 70</span>
                    <span>Warning: 70-85</span>
                    <span>Critical: &gt; 85</span>
                </div>
                <div class="heartrate-controls">
                    <button id="enableAutoRecovery" class="success">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Auto-Recovery
                    </button>
                    <button id="triggerCoolDown" class="warning">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 15V3M12 15L8 11M12 15L16 11M20 6.99999C19.8335 5.69841 19.2775 4.48255 18.4117 3.51616C17.5459 2.54977 16.414 1.88341 15.1741 1.60895C13.9341 1.33448 12.6458 1.46539 11.4789 1.98528C10.312 2.50517 9.3229 3.3899 8.65001 4.51999M4 6.99999C4.16649 5.69841 4.72246 4.48255 5.58827 3.51616C6.45408 2.54977 7.58599 1.88341 8.82595 1.60895C10.0659 1.33448 11.3542 1.46539 12.5211 1.98528C13.688 2.50517 14.6771 3.3899 15.35 4.51999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Cool Down
                    </button>
                    <button id="emergencyOverride" class="critical">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 9V11M12 15H12.01M5.07183 19H18.9282C20.4678 19 21.4301 17.3333 20.6603 16L13.7321 4C12.9623 2.66667 11.0378 2.66667 10.268 4L3.33978 16C2.56995 17.3333 3.53223 19 5.07183 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Emergency
                    </button>
                </div>
            </div>

            <div class="nodes-container" id="nodesContainer">
                <!-- Nodes will be dynamically generated here -->
            </div>

            <!-- Testing Section -->
            <div class="testing-section">
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V9L13 2Z" stroke="var(--warning)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 11V17M16 13V15M8 13V15M13 15H15M9 11H15" stroke="var(--warning)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Testing Panel
                </h2>
                <div class="testing-controls">
                    <button id="stressCPU" class="warning">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 3H6C4.34315 3 3 4.34315 3 6V18C3 19.6569 4.34315 21 6 21H18C19.6569 21 21 19.6569 21 18V6C21 4.34315 19.6569 3 18 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M9 9H15V15H9V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Stress CPU
                    </button>
                    <button id="simulateCrash" class="danger">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 14L12 12M12 12L14 10M12 12L10 10M12 12L14 14M4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Simulate Crash
                    </button>
                    <button id="recoveryTest" class="success">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 16H20M20 16L16 12M20 16L16 20M10 8H4M4 8L8 12M4 8L8 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Test Recovery
                    </button>
                    <button id="networkTest" class="warning">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 12H19M12 5V19M8.5 8.5L15.5 15.5M15.5 8.5L8.5 15.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Network Test
                    </button>
                </div>
            </div>

            <div class="log-panel">
                <div class="log-header">
                    <h2>System Log Terminal</h2>
                    <div class="log-controls">
                        <button id="clearLogs">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 7L18.1327 19.1425C18.0579 20.1891 17.187 21 16.1378 21H7.86224C6.81296 21 5.94208 20.1891 5.86732 19.1425L5 7M10 11V17M14 11V17M15 7V4C15 3.44772 14.5523 3 14 3H10C9.44772 3 9 3.44772 9 4V7M4 7H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Clear
                        </button>
                        <button id="exportLogs">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 15V3M12 15L8 11M12 15L16 11M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
                <div class="log-content" id="logContent">
                    <!-- Log entries will be dynamically added here -->
                </div>
            </div>
        </div>

        <div class="system-controls">
            <div class="control-group">
                <h3>Global Controls</h3>
                <div class="control-row">
                    <button id="pauseResume" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 5V19M14 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Pause All
                    </button>
                    <button id="resetNodes" class="warning" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.6569 6.34315C16.1566 4.84286 14.1217 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 9.87827 19.1571 7.84344 17.6569 6.34315ZM17.6569 6.34315L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Reset Nodes
                    </button>
                </div>
            </div>

            <div class="control-group">
                <h3>Node Operations</h3>
                <div class="control-row">
                    <button id="addNode" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Add Node
                    </button>
                    <button id="removeNode" class="danger" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Remove Node
                    </button>
                </div>
            </div>

            <div class="control-group">
                <h3>Simulation Speed</h3>
                <div class="control-row">
                    <button id="speedDown" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Slower
                    </button>
                    <button id="speedUp" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Faster
                    </button>
                </div>
            </div>

            <div class="communication-visualizer">
                <h3 class="comm-title">Node Communication</h3>
                <div class="comm-lines" id="commLines">
                    <!-- Communication lines will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // HAOS Controller Class
        class HAOSController {
            constructor() {
                this.nodes = [];
                this.logs = [];
                this.simulationRunning = false;
                this.simulationSpeed = 1;
                this.globalPaused = false;
                this.nextNodeId = 1;
                this.communicationInterval = null;
                this.monitoringInterval = null;
                this.heartRateInterval = null;
                this.heartRateData = Array(30).fill(60);
                this.currentHeartRate = 60;
                this.autoRecoveryEnabled = true;
                this.criticalState = false;
                this.heartRateChart = null;
                this.initEventListeners();
                this.initHeartRateMonitor();
                this.addInitialLog("HAOS Debugger initialized. Ready to start simulation.");
            }

            initEventListeners() {
                // Global controls
                document.getElementById('startSimulation').addEventListener('click', () => this.startSimulation());
                document.getElementById('triggerInterrupt').addEventListener('click', () => this.triggerGlobalInterrupt());
                document.getElementById('shutdownSystem').addEventListener('click', () => this.shutdownSystem());
                document.getElementById('pauseResume').addEventListener('click', () => this.togglePause());
                document.getElementById('resetNodes').addEventListener('click', () => this.resetNodes());
                document.getElementById('addNode').addEventListener('click', () => this.addNewNode());
                document.getElementById('removeNode').addEventListener('click', () => this.removeLastNode());
                document.getElementById('speedDown').addEventListener('click', () => this.adjustSpeed(-0.5));
                document.getElementById('speedUp').addEventListener('click', () => this.adjustSpeed(0.5));
                document.getElementById('clearLogs').addEventListener('click', () => this.clearLogs());
                document.getElementById('exportLogs').addEventListener('click', () => this.exportLogs());
                
                // Heart rate controls
                document.getElementById('enableAutoRecovery').addEventListener('click', () => this.toggleAutoRecovery());
                document.getElementById('triggerCoolDown').addEventListener('click', () => this.triggerCoolDown());
                document.getElementById('emergencyOverride').addEventListener('click', () => this.triggerEmergencyOverride());
                
                // Testing controls
                document.getElementById('stressCPU').addEventListener('click', () => this.stressCPUTest());
                document.getElementById('simulateCrash').addEventListener('click', () => this.simulateCrashTest());
                document.getElementById('recoveryTest').addEventListener('click', () => this.testRecovery());
                document.getElementById('networkTest').addEventListener('click', () => this.testNetwork());
            }

            initHeartRateMonitor() {
                const canvas = document.getElementById('heartrateGraph');
                if (!canvas) return;
                
                // Set canvas dimensions
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                // Initialize chart
                this.createHeartRateChart();
            }

            createHeartRateChart() {
                const canvas = document.getElementById('heartrateGraph');
                if (!canvas) return;
                
                this.heartRateChart = new Chart(canvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array(30).fill(''),
                        datasets: [{
                            label: 'Heart Rate',
                            data: this.heartRateData,
                            borderColor: 'var(--critical)',
                            backgroundColor: 'rgba(255, 85, 85, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 0
                        },
                        scales: {
                            x: {
                                display: false
                            },
                            y: {
                                min: 50,
                                max: 100,
                                grid: {
                                    color: 'rgba(220, 215, 186, 0.1)'
                                },
                                ticks: {
                                    color: 'var(--text-secondary)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: false
                            }
                        }
                    }
                });
            }

            startHeartRateMonitoring() {
                if (this.heartRateInterval) clearInterval(this.heartRateInterval);
                
                this.heartRateInterval = setInterval(() => {
                    if (this.globalPaused) return;
                    
                    // Calculate system load
                    const systemLoad = this.calculateSystemLoad();
                    let heartRateChange = 0;
                    
                    if (systemLoad > 70) {
                        heartRateChange = Math.random() * 3 + 1;
                    } else if (systemLoad > 50) {
                        heartRateChange = (Math.random() * 2 - 1);
                    } else {
                        heartRateChange = -Math.random();
                    }
                    
                    // Apply change
                    this.currentHeartRate = Math.max(50, Math.min(100, 
                        this.currentHeartRate + heartRateChange * this.simulationSpeed));
                    
                    // Random spikes
                    if (Math.random() > 0.95) {
                        this.currentHeartRate = Math.min(100, this.currentHeartRate + 10 + Math.random() * 10);
                        this.addLog(`Heart rate spike detected: ${Math.round(this.currentHeartRate)} BPM`, "warning");
                    }
                    
                    // Update data
                    this.heartRateData.push(Math.round(this.currentHeartRate));
                    if (this.heartRateData.length > 30) {
                        this.heartRateData.shift();
                    }
                    
                    // Update chart
                    if (this.heartRateChart) {
                        this.heartRateChart.data.datasets[0].data = this.heartRateData;
                        this.heartRateChart.update();
                    }
                    
                    // Update display
                    this.updateHeartRateDisplay();
                    
                    // Check status
                    this.checkHeartRateStatus();
                }, 1000);
            }

            calculateSystemLoad() {
                if (this.nodes.length === 0) return 0;
                
                let totalLoad = 0;
                let activeNodes = 0;
                
                this.nodes.forEach(node => {
                    if (node.status === 'running') {
                        totalLoad += (node.cpu * 0.7 + node.memory * 0.3);
                        activeNodes++;
                    }
                });
                
                return activeNodes > 0 ? totalLoad / activeNodes : 0;
            }

            updateHeartRateDisplay() {
                const heartrateValue = document.getElementById('heartrateValue');
                if (!heartrateValue) return;
                
                heartrateValue.textContent = Math.round(this.currentHeartRate);
                
                // Update color
                heartrateValue.className = 'heartrate-value ';
                if (this.currentHeartRate > 85) {
                    heartrateValue.className += 'heartrate-critical';
                } else if (this.currentHeartRate > 70) {
                    heartrateValue.className += 'heartrate-warning';
                } else {
                    heartrateValue.className += 'heartrate-normal';
                }
            }

            checkHeartRateStatus() {
                const monitor = document.querySelector('.heartrate-monitor');
                if (!monitor) return;
                
                if (this.currentHeartRate > 85 && !this.criticalState) {
                    this.criticalState = true;
                    this.addLog(`CRITICAL: System heart rate exceeded threshold (${Math.round(this.currentHeartRate)} BPM)`, "critical");
                    monitor.classList.add('node-critical');
                    
                    if (this.autoRecoveryEnabled) {
                        this.addLog("Auto-recovery protocol initiated", "warning");
                        this.triggerCoolDown();
                    }
                } else if (this.currentHeartRate <= 80 && this.criticalState) {
                    this.criticalState = false;
                    this.addLog(`System heart rate stabilized (${Math.round(this.currentHeartRate)} BPM)`, "success");
                    monitor.classList.remove('node-critical');
                }
            }

            toggleAutoRecovery() {
                this.autoRecoveryEnabled = !this.autoRecoveryEnabled;
                const button = document.getElementById('enableAutoRecovery');
                
                if (this.autoRecoveryEnabled) {
                    button.classList.add('success');
                    button.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Auto-Recovery
                    `;
                    this.addLog("Auto-recovery protocol enabled", "success");
                } else {
                    button.classList.remove('success');
                    button.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Auto-Recovery
                    `;
                    this.addLog("Auto-recovery protocol disabled", "warning");
                }
            }

            triggerCoolDown() {
                if (this.globalPaused) return;
                
                this.addLog("Initiating system cool down procedure...", "warning");
                
                // Reduce heart rate
                this.currentHeartRate = Math.max(60, this.currentHeartRate - (10 + Math.random() * 10));
                
                // Reduce node resource usage
                this.nodes.forEach(node => {
                    if (node.status === 'running') {
                        node.cpu = Math.max(0, node.cpu - (10 + Math.random() * 15));
                        node.memory = Math.max(0, node.memory - (5 + Math.random() * 10));
                        
                        // Remove some processes
                        if (node.processes.length > 0 && Math.random() > 0.3) {
                            const process = node.processes.pop();
                            this.addLog(`${node.name} terminated process for cool down: ${process.description}`, "info");
                        }
                    }
                });
                
                this.addLog("Cool down procedure completed", "success");
                this.renderNodes();
            }

            triggerEmergencyOverride() {
                this.addLog("EMERGENCY OVERRIDE ACTIVATED!", "critical");
                
                // Immediately reduce heart rate
                this.currentHeartRate = 60;
                
                // Reset all nodes
                this.nodes.forEach(node => {
                    node.status = 'running';
                    node.cpu = 0;
                    node.memory = 0;
                    node.disk = 0;
                    node.network = 0;
                    node.processes = [];
                    this.addProcessToNode(node.id, 'system', 'Emergency reset');
                });
                
                // Disable critical state
                this.criticalState = false;
                document.querySelector('.heartrate-monitor')?.classList.remove('node-critical');
                
                this.addLog("Emergency override complete. All systems reset.", "success");
                this.renderNodes();
            }

            startSimulation() {
                if (this.simulationRunning) return;
                
                this.simulationRunning = true;
                this.addInitialLog("Starting HAOS simulation...");
                
                // Create initial nodes
                this.createNode();
                this.createNode();
                this.createNode();
                
                // Start monitoring
                this.startNodeMonitoring();
                this.startHeartRateMonitoring();
                this.startCommunicationSimulation();
                
                // Update UI state
                this.updateControlStates();
                
                this.addLog("Simulation started successfully with 3 nodes", "success");
            }

            createNode() {
                const nodeId = this.nextNodeId++;
                const node = {
                    id: nodeId,
                    name: `Node-${nodeId}`,
                    status: 'idle',
                    cpu: 0,
                    memory: 0,
                    disk: 0,
                    network: 0,
                    paused: false,
                    processes: []
                };
                
                this.nodes.push(node);
                this.renderNodes();
                this.simulateNodeBoot(nodeId);
                
                return nodeId;
            }

            simulateNodeBoot(nodeId) {
                const node = this.getNodeById(nodeId);
                if (!node) return;
                
                node.status = 'booting';
                this.addLog(`${node.name} is booting...`, "info");
                this.renderNodes();
                
                setTimeout(() => {
                    node.status = 'running';
                    this.addProcessToNode(nodeId, 'system', 'System initialization');
                    this.addLog(`${node.name} booted successfully`, "success");
                    this.renderNodes();
                }, 2000);
            }

            addProcessToNode(nodeId, type, description) {
                const node = this.getNodeById(nodeId);
                if (!node) return;
                
                const process = {
                    id: Date.now(),
                    type,
                    description,
                    startTime: new Date(),
                    cpuUsage: Math.random() * 30 + 10,
                    memoryUsage: Math.random() * 20 + 5
                };
                
                node.processes.push(process);
                return process;
            }

            startNodeMonitoring() {
                if (this.monitoringInterval) clearInterval(this.monitoringInterval);
                
                this.monitoringInterval = setInterval(() => {
                    if (this.globalPaused) return;
                    
                    this.nodes.forEach(node => {
                        if (node.status === 'running' && !node.paused) {
                            // Update resource usage
                            node.cpu = Math.min(100, Math.max(0, 
                                node.cpu + (Math.random() * 10 - 5) * this.simulationSpeed));
                            node.memory = Math.min(100, Math.max(0, 
                                node.memory + (Math.random() * 5 - 2) * this.simulationSpeed));
                            node.disk = Math.min(100, Math.max(0, 
                                node.disk + (Math.random() * 3 - 1) * this.simulationSpeed));
                            node.network = Math.min(100, Math.max(0, 
                                node.network + (Math.random() * 8 - 4) * this.simulationSpeed));
                            
                            // Randomly add/remove processes
                            if (Math.random() > 0.7 && node.processes.length < 5) {
                                const types = ['system', 'user', 'daemon', 'network'];
                                const descs = [
                                    'Memory allocation',
                                    'Disk I/O operation',
                                    'Network request',
                                    'Process scheduling',
                                    'Interrupt handling'
                                ];
                                const type = types[Math.floor(Math.random() * types.length)];
                                const desc = descs[Math.floor(Math.random() * descs.length)];
                                this.addProcessToNode(node.id, type, desc);
                                this.addLog(`${node.name} started new process: ${desc}`, "info");
                            }
                            
                            if (Math.random() > 0.8 && node.processes.length > 0) {
                                const process = node.processes.pop();
                                this.addLog(`${node.name} completed process: ${process.description}`, "info");
                            }
                            
                            // Random status changes
                            if (Math.random() > 0.95) {
                                node.status = Math.random() > 0.5 ? 'waiting' : 'running';
                            }
                            
                            // Check for critical conditions
                            if (node.cpu > 90 && Math.random() > 0.8) {
                                this.triggerNodeInterrupt(node.id);
                            }
                        }
                    });
                    
                    this.renderNodes();
                }, 1000);
            }

            startCommunicationSimulation() {
                if (this.communicationInterval) clearInterval(this.communicationInterval);
                
                this.communicationInterval = setInterval(() => {
                    if (this.globalPaused || this.nodes.length < 2) return;
                    
                    const node1Index = Math.floor(Math.random() * this.nodes.length);
                    let node2Index;
                    do {
                        node2Index = Math.floor(Math.random() * this.nodes.length);
                    } while (node2Index === node1Index);
                    
                    const node1 = this.nodes[node1Index];
                    const node2 = this.nodes[node2Index];
                    
                    if (node1.status === 'running' && node2.status === 'running') {
                        const messages = [
                            `Heartbeat check`,
                            `Resource status update`,
                            `Synchronization request`,
                            `Task delegation`,
                            `Load balancing update`
                        ];
                        const message = messages[Math.floor(Math.random() * messages.length)];
                        
                        this.addCommunicationLine(node1.name, node2.name, message);
                        
                        if (Math.random() > 0.6) {
                            setTimeout(() => {
                                this.addCommunicationLine(node2.name, node1.name, `Acknowledgment`);
                            }, 500);
                        }
                    }
                }, 3000 / this.simulationSpeed);
            }

            addCommunicationLine(from, to, message) {
                const commLines = document.getElementById('commLines');
                if (!commLines) return;
                
                const line = document.createElement('div');
                line.className = 'comm-line';
                line.innerHTML = `
                    <div class="comm-dot"></div>
                    <span>${from}  ${to}:</span>
                    <span class="comm-message">${message}</span>
                `;
                commLines.appendChild(line);
                
                commLines.scrollTop = commLines.scrollHeight;
                if (commLines.children.length > 10) {
                    commLines.removeChild(commLines.children[0]);
                }
            }

            triggerGlobalInterrupt() {
                this.addLog("Triggering global interrupt across all nodes...", "warning");
                
                this.nodes.forEach(node => {
                    if (node.status === 'running') {
                        this.triggerNodeInterrupt(node.id);
                    }
                });
            }

            triggerNodeInterrupt(nodeId) {
                const node = this.getNodeById(nodeId);
                if (!node || node.status !== 'running') return;
                
                node.status = 'waiting';
                this.addProcessToNode(nodeId, 'system', 'Interrupt handling');
                this.addLog(`Interrupt triggered on ${node.name}`, "warning");
                
                const nodeElement = document.querySelector(`.node[data-id="${nodeId}"]`);
                if (nodeElement) {
                    nodeElement.classList.add('node-error');
                    setTimeout(() => nodeElement.classList.remove('node-error'), 1500);
                }
                
                setTimeout(() => {
                    node.status = 'running';
                    this.addLog(`${node.name} completed interrupt handling`, "success");
                    this.renderNodes();
                }, 2000 / this.simulationSpeed);
                
                this.renderNodes();
            }

            shutdownSystem() {
                if (!this.simulationRunning) return;
                
                this.addLog("Initiating system shutdown...", "warning");
                this.simulationRunning = false;
                
                // Clear intervals
                clearInterval(this.monitoringInterval);
                clearInterval(this.communicationInterval);
                clearInterval(this.heartRateInterval);
                
                // Shutdown all nodes
                this.nodes.forEach(node => {
                    node.status = 'terminated';
                    this.addLog(`Shutting down ${node.name}...`, "info");
                });
                
                // Reset heart rate
                this.currentHeartRate = 60;
                this.heartRateData = Array(30).fill(60);
                if (this.heartRateChart) {
                    this.heartRateChart.data.datasets[0].data = this.heartRateData;
                    this.heartRateChart.update();
                }
                this.updateHeartRateDisplay();
                
                this.renderNodes();
                this.updateControlStates();
                
                setTimeout(() => {
                    this.addLog("HAOS simulation successfully terminated", "success");
                }, 1500);
            }

            togglePause() {
                this.globalPaused = !this.globalPaused;
                
                if (this.globalPaused) {
                    this.addLog("Simulation paused", "warning");
                    document.getElementById('pauseResume').innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 3L19 12L5 21V3Z" fill="currentColor"/>
                        </svg>
                        Resume All
                    `;
                } else {
                    this.addLog("Simulation resumed", "success");
                    document.getElementById('pauseResume').innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 5V19M14 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Pause All
                    `;
                }
                
                this.nodes.forEach(node => {
                    node.paused = this.globalPaused;
                });
                
                this.renderNodes();
            }

            resetNodes() {
                this.addLog("Resetting all nodes...", "warning");
                
                this.nodes.forEach(node => {
                    node.status = 'running';
                    node.cpu = 0;
                    node.memory = 0;
                    node.disk = 0;
                    node.network = 0;
                    node.processes = [];
                    this.addProcessToNode(node.id, 'system', 'System reset');
                });
                
                this.addLog("All nodes reset to initial state", "success");
                this.renderNodes();
            }

            addNewNode() {
                if (this.nodes.length >= 6) {
                    this.addLog("Maximum node limit reached (6 nodes)", "error");
                    return;
                }
                
                const nodeId = this.createNode();
                this.addLog(`Added new node: Node-${nodeId}`, "success");
            }

            removeLastNode() {
                if (this.nodes.length <= 1) {
                    this.addLog("Cannot remove the last remaining node", "error");
                    return;
                }
                
                const removedNode = this.nodes.pop();
                this.addLog(`Removed node: ${removedNode.name}`, "warning");
                this.renderNodes();
            }

            adjustSpeed(change) {
                const newSpeed = Math.max(0.5, Math.min(3, this.simulationSpeed + change));
                if (newSpeed === this.simulationSpeed) return;
                
                this.simulationSpeed = newSpeed;
                this.addLog(`Simulation speed set to ${newSpeed.toFixed(1)}x`, "info");
                
                if (this.communicationInterval) {
                    clearInterval(this.communicationInterval);
                    this.startCommunicationSimulation();
                }
            }

            getNodeById(nodeId) {
                return this.nodes.find(node => node.id === nodeId);
            }

            addInitialLog(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.logs.push({ timestamp, message, severity: "info" });
                this.renderLogs();
            }

            addLog(message, severity = "info") {
                const timestamp = new Date().toLocaleTimeString();
                this.logs.push({ timestamp, message, severity });
                this.renderLogs();
            }

            clearLogs() {
                this.logs = [];
                document.getElementById('logContent').innerHTML = '';
                this.addInitialLog("Log terminal cleared");
            }

            exportLogs() {
                let logText = "HAOS Debugger Log Export\n\n";
                logText += `System Heart Rate Data:\n`;
                logText += `Current: ${Math.round(this.currentHeartRate)} BPM\n`;
                logText += `Average: ${Math.round(this.heartRateData.reduce((a, b) => a + b, 0) / this.heartRateData.length)} BPM\n`;
                logText += `Max: ${Math.round(Math.max(...this.heartRateData))} BPM\n`;
                logText += `Min: ${Math.round(Math.min(...this.heartRateData))} BPM\n\n`;
                
                logText += "Event Logs:\n";
                this.logs.forEach(log => {
                    logText += `[${log.timestamp}] ${log.message}\n`;
                });
                
                const blob = new Blob([logText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `haos-logs-${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.addLog("Logs exported successfully", "success");
            }

            updateControlStates() {
                const running = this.simulationRunning;
                document.getElementById('triggerInterrupt').disabled = !running;
                document.getElementById('shutdownSystem').disabled = !running;
                document.getElementById('pauseResume').disabled = !running;
                document.getElementById('resetNodes').disabled = !running;
                document.getElementById('addNode').disabled = !running;
                document.getElementById('removeNode').disabled = !running || this.nodes.length <= 1;
                document.getElementById('speedDown').disabled = !running || this.simulationSpeed <= 0.5;
                document.getElementById('speedUp').disabled = !running || this.simulationSpeed >= 3;
                document.getElementById('startSimulation').disabled = running;
            }

            renderNodes() {
                const container = document.getElementById('nodesContainer');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.nodes.forEach(node => {
                    const nodeElement = document.createElement('div');
                    nodeElement.className = `node ${node.status}`;
                    nodeElement.dataset.id = node.id;
                    
                    if (node.status === 'booting') {
                        nodeElement.classList.add('node-booting');
                    } else if (node.status === 'terminated') {
                        nodeElement.classList.add('node-shutting-down');
                    } else if (node.cpu > 90) {
                        nodeElement.classList.add('node-critical');
                    }
                    
                    nodeElement.innerHTML = `
                        <div class="node-header">
                            <div class="node-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="4" y="4" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                    <path d="M8 8H16V16H8V8Z" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                ${node.name}
                            </div>
                            <div class="node-status status-${node.status}">${node.status}</div>
                        </div>
                        <div class="node-body">
                            <div class="metrics">
                                <div class="metric">
                                    <div class="metric-label">
                                        <span>CPU Usage</span>
                                        <span class="metric-value">${node.cpu.toFixed(1)}%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar cpu-progress" style="width: ${node.cpu}%"></div>
                                    </div>
                                </div>
                                <div class="metric">
                                    <div class="metric-label">
                                        <span>Memory Usage</span>
                                        <span class="metric-value">${node.memory.toFixed(1)}%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar memory-progress" style="width: ${node.memory}%"></div>
                                    </div>
                                </div>
                                <div class="metric">
                                    <div class="metric-label">
                                        <span>Disk I/O</span>
                                        <span class="metric-value">${node.disk.toFixed(1)}%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar disk-progress" style="width: ${node.disk}%"></div>
                                    </div>
                                </div>
                                <div class="metric">
                                    <div class="metric-label">
                                        <span>Network</span>
                                        <span class="metric-value">${node.network.toFixed(1)}%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar network-progress" style="width: ${node.network}%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="node-actions">
                                <button onclick="haosController.triggerNodeInterrupt(${node.id})" ${node.status !== 'running' ? 'disabled' : ''}>
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                                        <path d="M12 8V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    Interrupt
                                </button>
                                <button onclick="haosController.toggleNodePause(${node.id})" ${node.status !== 'running' ? 'disabled' : ''}>
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M10 5V19M14 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    ${node.paused ? 'Resume' : 'Pause'}
                                </button>
                                <button onclick="haosController.resetNode(${node.id})" ${node.status !== 'running' ? 'disabled' : ''}>
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17.6569 6.34315C16.1566 4.84286 14.1217 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 9.87827 19.1571 7.84344 17.6569 6.34315ZM17.6569 6.34315L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    Reset
                                </button>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(nodeElement);
                });
            }

            renderLogs() {
                const logContent = document.getElementById('logContent');
                if (!logContent) return;
                
                logContent.innerHTML = '';
                
                this.logs.forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = `log-entry`;
                    logEntry.innerHTML = `
                        <span class="log-timestamp">[${log.timestamp}]</span>
                        <span class="log-message log-${log.severity}">${log.message}</span>
                    `;
                    logContent.appendChild(logEntry);
                });
                
                logContent.scrollTop = logContent.scrollHeight;
            }

            toggleNodePause(nodeId) {
                const node = this.getNodeById(nodeId);
                if (!node || node.status !== 'running') return;
                
                node.paused = !node.paused;
                this.addLog(`${node.name} ${node.paused ? 'paused' : 'resumed'}`, node.paused ? "warning" : "success");
                this.renderNodes();
            }

            resetNode(nodeId) {
                const node = this.getNodeById(nodeId);
                if (!node || node.status !== 'running') return;
                
                node.cpu = 0;
                node.memory = 0;
                node.disk = 0;
                node.network = 0;
                node.processes = [];
                this.addProcessToNode(nodeId, 'system', 'System reset');
                this.addLog(`${node.name} reset to initial state`, "success");
                this.renderNodes();
            }

            /***************************************/
            /* TESTING FUNCTIONS - CLEARLY MARKED */
            /***************************************/
            
            stressCPUTest() {
                this.addLog("TESTING: Simulating CPU stress on all nodes", "warning");
                
                this.nodes.forEach(node => {
                    if (node.status === 'running') {
                        node.cpu = 90 + Math.random() * 10;
                        node.memory = Math.min(100, node.memory + 20);
                        this.addProcessToNode(node.id, 'stress', 'CPU stress test');
                    }
                });
                
                // Spike heart rate
                this.currentHeartRate = 95 + Math.random() * 5;
                this.updateHeartRateDisplay();
                this.checkHeartRateStatus();
                
                this.addLog("TESTING: CPU stress test completed", "info");
                this.renderNodes();
            }

            simulateCrashTest() {
                if (this.nodes.length === 0) {
                    this.addLog("TESTING: No nodes available to crash", "error");
                    return;
                }
                
                // Select a random running node
                const runningNodes = this.nodes.filter(node => node.status === 'running');
                if (runningNodes.length === 0) {
                    this.addLog("TESTING: No running nodes available to crash", "error");
                    return;
                }
                
                const node = runningNodes[Math.floor(Math.random() * runningNodes.length)];
                this.addLog(`TESTING: Simulating crash on ${node.name}`, "warning");
                
                // Crash the node
                node.status = 'terminated';
                node.cpu = 0;
                node.memory = 0;
                node.disk = 0;
                node.network = 0;
                node.processes = [];
                
                // Affect heart rate
                this.currentHeartRate = Math.min(100, this.currentHeartRate + 15);
                this.updateHeartRateDisplay();
                this.checkHeartRateStatus();
                
                this.renderNodes();
                
                if (this.autoRecoveryEnabled) {
                    setTimeout(() => {
                        this.addLog(`TESTING: Auto-recovery restarting ${node.name}`, "info");
                        this.simulateNodeBoot(node.id);
                    }, 3000);
                }
            }

            testRecovery() {
                this.addLog("TESTING: Starting full recovery test sequence", "warning");
                
                // Step 1: Stress the system
                this.stressCPUTest();
                
                // Step 2: Crash a node
                setTimeout(() => {
                    this.simulateCrashTest();
                    
                    // Step 3: Test cool down
                    setTimeout(() => {
                        if (this.criticalState) {
                            this.addLog("TESTING: System in critical state - testing cool down", "warning");
                            this.triggerCoolDown();
                        }
                        
                        // Step 4: Verify recovery
                        setTimeout(() => {
                            const recovered = this.nodes.every(node => node.status === 'running');
                            if (recovered) {
                                this.addLog("TESTING: Recovery test completed successfully", "success");
                            } else {
                                this.addLog("TESTING: Recovery test completed with some nodes down", "warning");
                            }
                        }, 3000);
                    }, 2000);
                }, 1000);
            }

            testNetwork() {
                this.addLog("TESTING: Simulating network issues", "warning");
                
                // Randomly affect network on all nodes
                this.nodes.forEach(node => {
                    if (node.status === 'running') {
                        node.network = Math.min(100, node.network + 30 + Math.random() * 40);
                        this.addProcessToNode(node.id, 'network', 'Network stress test');
                    }
                });
                
                // Add network communication errors
                for (let i = 0; i < 3; i++) {
                    if (this.nodes.length >= 2) {
                        const node1 = this.nodes[Math.floor(Math.random() * this.nodes.length)];
                        const node2 = this.nodes[Math.floor(Math.random() * this.nodes.length)];
                        if (node1 !== node2) {
                            this.addCommunicationLine(node1.name, node2.name, "NETWORK ERROR: Packet loss");
                        }
                    }
                }
                
                this.addLog("TESTING: Network test completed", "info");
                this.renderNodes();
            }
        }

        // Initialize when both DOM and Chart.js are ready
        function initHAOS() {
            if (document.readyState === 'complete' && typeof Chart !== 'undefined') {
                window.haosController = new HAOSController();
            } else {
                setTimeout(initHAOS, 100);
            }
        }

        // Start initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initHAOS);
        } else {
            initHAOS();
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>